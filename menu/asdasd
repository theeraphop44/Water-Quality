import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import os


def run_data_page(df):
    #df = st.session_state["df"]
    # Name Title 
    st.markdown('# Water Queality')
    st.markdown('---')
    col4 , col5 , col6 , col7 = st.columns(4)
    st.markdown('---')
    with col4:
        See_Data = st.checkbox("Data",True)
    with col5:
        See_nun_lsnull = st.checkbox("Feature/Target",True)
    with col6:
        See_bar_potability = st.checkbox("Potability Bar",True)
    with col7:
        See_lsnull = st.checkbox("lsnull",True)

    st.write("Replace Data")
    Replace = st.button("Replace")
    st.markdown('---')
    if df is not None:
        
        if Replace:
            df['ph'] = df['ph'].replace(np.nan, df.ph.mean())
            df['Sulfate'] = df['Sulfate'].replace(np.nan,df.Sulfate.mean())
            df['Trihalomethanes'] = df['Trihalomethanes'].replace(np.nan,df.Trihalomethanes.mean())
            df.isnull().sum()
            see_data(df)
            
            
        if See_Data:
            #st.write("Data from the CSV file:")
            #st.write(df)
            #st.markdown("---")
            #st.write("Shape of Data : ",df.shape)
            #st.markdown("---")
            see_data(df)
            
        if See_nun_lsnull:
            #columns
            col1_nun, col2_nun = st.columns(2) 
        

            #nunique and isnull 

            with col1_nun:
                st.header("Feature")
                nundel_feature = df.drop(["Potability"],axis=1)
                ss = nundel_feature.rename(columns={"": 'Feature'})
                st.write(ss.columns)

            with col2_nun:
                st.header("target")
                numdel_target = df[['Potability']]
                st.write(numdel_target.columns)

            st.markdown('---')
            
        if See_bar_potability:
            # Specify the target folder
            target_folder = "Picture"

            # Create the target folder if it doesn't exist
            os.makedirs(target_folder, exist_ok=True)

            # Count Plot
            sns.set(style="whitegrid")
            plt.figure(figsize=(10, 6))
            sns.countplot(data=df, x="Potability", palette="Set1")
            plt.title("Potability Count")
            plt.xlabel("Potability")
            plt.ylabel("Count")

            # Save the count plot image to the target folder
            count_plot_file_path = os.path.join(target_folder, "count_plot.png")
            plt.savefig(count_plot_file_path)

            # Display the image from the target location
            st.image(count_plot_file_path)

            # Optional: Add a centered text below the image
            st.markdown("<div style='text-align: center;'>Potability</div>", unsafe_allow_html=True)
            
            st.markdown('---')
            
        if See_lsnull:
            col1,col2,col3 = st.columns(3)
            with col2:
                st.header("Isnull")
                null = df.isnull().sum()
                st.write(null)  
 
def see_data(df):
    st.write("Data from the CSV file:")
    st.write(df)
    st.markdown("---")
    st.write("Shape of Data : ",df.shape)
    st.markdown("---")

def Replace(df):
    df['ph'] = df['ph'].replace(np.nan, df.ph.mean())
    df['Sulfate'] = df['Sulfate'].replace(np.nan,df.Sulfate.mean())
    df['Trihalomethanes'] = df['Trihalomethanes'].replace(np.nan,df.Trihalomethanes.mean())
    df.isnull().sum()
    see_data(df)
   